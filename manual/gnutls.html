<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual is last updated 24 April 2013 for version
3.2.0 of GnuTLS.

Copyright (C) 2001-2013 Free Software Foundation, Inc.\\
Copyright (C) 2001-2013 Nikos Mavrogiannopoulos

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled "GNU Free
Documentation License". -->
<!-- Created by GNU Texinfo 5.1, http://www.gnu.org/software/texinfo/ -->
<head>
<title>GnuTLS 3.2.0</title>

<meta name="description" content="GnuTLS 3.2.0">
<meta name="keywords" content="GnuTLS 3.2.0">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#Top" rel="start" title="Top">
<link href="#Function-and-Data-Index" rel="index" title="Function and Data Index">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="dir.html#Top" rel="up" title="(dir)">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
body { 
	margin: 2%;
	padding: 0 5%;
	background: #ffffff;
}
h1,h2,h3,h4,h5 {
    font-weight: bold;
    padding: 5px 5px 5px 5px;
    background-color: #c2e0ff;
    color: #336699;
}
h1 {
    padding: 2em 2em 2em 5%;
    color: white;
    background: #336699;
    text-align: center;
    letter-spacing: 3px;
}
h2 { text-decoration: underline; }
pre {
  margin: 0 5%;
  padding: 0.5em;
}
pre.example,pre.verbatim {
  padding-bottom: 1em;

  border: solid #c2e0ff;
  background: #f0faff;
  border-width: 1px 1px 1px 5px;
  margin: 1em auto;
  width: 90%;
}

div.node {
  margin: 0 -5% 0 -2%;
  padding: 0.5em 0.5em;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
  font-weight: bold;
}
dd, li {
  padding-top: 0.1em;
  padding-bottom: 0.1em;
}
div.float {

  margin-bottom: 0.5em;
  text-align: center;
}

table {
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  width: 50%;
}

th {
  padding: 0;
  color: #336699;
  background-color: #c2e0ff;
  border: solid #000000;
  border-width: 0px;
  margin: 1em auto;
  text-align: center;
  margin-left:auto;
  margin-right:auto;
}

td {
  padding: 0;
  border: solid #000000;
  background-color: #f0faff;
  border-width: 0px;
  margin: 1em auto;
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  padding-left: 1em;
}

dl {
  text-align: left;
  margin-left:auto;
  margin-right:auto;
  width: 50%;

  padding-left: 1em;
  border: solid #c2e0ff;
  background: #f0faff;
  border-width: 5px 1px 1px 1px;
  margin: 1em auto;
}

-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<h1 class="settitle" align="center">GnuTLS 3.2.0</h1>


















<a name="SEC_Contents"></a>
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="no-bullet">
  <li><a name="toc-Preface-1" href="#Preface">1 Preface</a></li>
  <li><a name="toc-Introduction-to-GnuTLS-1" href="#Introduction-to-GnuTLS">2 Introduction to GnuTLS</a>
  <ul class="no-bullet">
    <li><a name="toc-Downloading-and-installing-1" href="#Downloading-and-installing">2.1 Downloading and installing</a></li>
    <li><a name="toc-Overview" href="#Document-overview">2.2 Overview</a></li>
  </ul></li>
  <li><a name="toc-Introduction-to-TLS-and-DTLS" href="#Introduction-to-TLS">3 Introduction to <acronym>TLS</acronym> and <acronym>DTLS</acronym></a>
  <ul class="no-bullet">
    <li><a name="toc-TLS-layers-1" href="#TLS-layers">3.1 TLS layers</a></li>
    <li><a name="toc-The-transport-layer-1" href="#The-transport-layer">3.2 The transport layer</a></li>
    <li><a name="toc-The-TLS-record-protocol-1" href="#The-TLS-record-protocol">3.3 The TLS record protocol</a>
    <ul class="no-bullet">
      <li><a name="toc-Encryption-algorithms-used-in-the-record-layer-1" href="#Encryption-algorithms-used-in-the-record-layer">3.3.1 Encryption algorithms used in the record layer</a></li>
      <li><a name="toc-Compression-algorithms-used-in-the-record-layer-1" href="#Compression-algorithms-used-in-the-record-layer">3.3.2 Compression algorithms used in the record layer</a></li>
      <li><a name="toc-Weaknesses-and-countermeasures-1" href="#Weaknesses-and-countermeasures">3.3.3 Weaknesses and countermeasures</a></li>
      <li><a name="toc-On-record-padding" href="#On-Record-Padding">3.3.4 On record padding</a></li>
    </ul></li>
    <li><a name="toc-The-TLS-alert-protocol" href="#The-TLS-Alert-Protocol">3.4 The TLS alert protocol</a></li>
    <li><a name="toc-The-TLS-handshake-protocol" href="#The-TLS-Handshake-Protocol">3.5 The TLS handshake protocol</a>
    <ul class="no-bullet">
      <li><a name="toc-TLS-ciphersuites" href="#TLS-Cipher-Suites">3.5.1 TLS ciphersuites</a></li>
      <li><a name="toc-Authentication-1" href="#Authentication">3.5.2 Authentication</a></li>
      <li><a name="toc-Client-authentication" href="#Client-Authentication">3.5.3 Client authentication</a></li>
      <li><a name="toc-Resuming-sessions" href="#Resuming-Sessions">3.5.4 Resuming sessions</a></li>
    </ul></li>
    <li><a name="toc-TLS-extensions" href="#TLS-Extensions">3.6 TLS extensions</a>
    <ul class="no-bullet">
      <li><a name="toc-Maximum-fragment-length-negotiation-1" href="#Maximum-fragment-length-negotiation">3.6.1 Maximum fragment length negotiation</a></li>
      <li><a name="toc-Server-name-indication-1" href="#Server-name-indication">3.6.2 Server name indication</a></li>
      <li><a name="toc-Session-tickets-1" href="#Session-tickets">3.6.3 Session tickets</a></li>
      <li><a name="toc-HeartBeat-1" href="#HeartBeat">3.6.4 HeartBeat</a></li>
      <li><a name="toc-Safe-renegotiation-1" href="#Safe-renegotiation">3.6.5 Safe renegotiation</a></li>
      <li><a name="toc-OCSP-status-request-1" href="#OCSP-status-request">3.6.6 OCSP status request</a></li>
      <li><a name="toc-SRTP-1" href="#SRTP">3.6.7 SRTP</a></li>
      <li><a name="toc-Application-Layer-Protocol-Negotiation-_0028ALPN_0029-1" href="#Application-Layer-Protocol-Negotiation-_0028ALPN_0029">3.6.8 Application Layer Protocol Negotiation (ALPN)</a></li>
    </ul></li>
    <li><a name="toc-How-to-use-TLS-in-application-protocols-1" href="#How-to-use-TLS-in-application-protocols">3.7 How to use <acronym>TLS</acronym> in application protocols</a>
    <ul class="no-bullet">
      <li><a name="toc-Separate-ports-1" href="#Separate-ports">3.7.1 Separate ports</a></li>
      <li><a name="toc-Upward-negotiation-1" href="#Upward-negotiation">3.7.2 Upward negotiation</a></li>
    </ul></li>
    <li><a name="toc-On-SSL-2-and-older-protocols-1" href="#On-SSL-2-and-older-protocols">3.8 On SSL 2 and older protocols</a></li>
  </ul></li>
  <li><a name="toc-Authentication-methods-1" href="#Authentication-methods">4 Authentication methods</a>
  <ul class="no-bullet">
    <li><a name="toc-Certificate-authentication-1" href="#Certificate-authentication">4.1 Certificate authentication</a>
    <ul class="no-bullet">
      <li><a name="toc-X_002e509-certificates-1" href="#X_002e509-certificates">4.1.1 <acronym>X.509</acronym> certificates</a>
      <ul class="no-bullet">
        <li><a name="toc-X_002e509-certificate-structure-1" href="#X_002e509-certificate-structure">4.1.1.1 <acronym>X.509</acronym> certificate structure</a></li>
        <li><a name="toc-Importing-an-X_002e509-certificate-1" href="#Importing-an-X_002e509-certificate">4.1.1.2 Importing an X.509 certificate</a></li>
        <li><a name="toc-X_002e509-distinguished-names-1" href="#X_002e509-distinguished-names">4.1.1.3 X.509 distinguished names</a></li>
        <li><a name="toc-Accessing-public-and-private-keys" href="#X_002e509-public-and-private-keys">4.1.1.4 Accessing public and private keys</a></li>
        <li><a name="toc-Verifying-X_002e509-certificate-paths-1" href="#Verifying-X_002e509-certificate-paths">4.1.1.5 Verifying <acronym>X.509</acronym> certificate paths</a></li>
        <li><a name="toc-Verifying-a-certificate-in-the-context-of-TLS-session-1" href="#Verifying-a-certificate-in-the-context-of-TLS-session">4.1.1.6 Verifying a certificate in the context of TLS session</a></li>
      </ul></li>
      <li><a name="toc-OpenPGP-certificates-1" href="#OpenPGP-certificates">4.1.2 <acronym>OpenPGP</acronym> certificates</a>
      <ul class="no-bullet">
        <li><a name="toc-OpenPGP-certificate-structure" href="#OpenPGP-certificate-structure">4.1.2.1 <acronym>OpenPGP</acronym> certificate structure</a></li>
        <li><a name="toc-Verifying-an-OpenPGP-certificate" href="#Verifying-an-OpenPGP-certificate">4.1.2.2 Verifying an <acronym>OpenPGP</acronym> certificate</a></li>
        <li><a name="toc-Verifying-a-certificate-in-the-context-of-a-TLS-session" href="#Verifying-a-certificate-in-the-context-of-a-TLS-session">4.1.2.3 Verifying a certificate in the context of a TLS session</a></li>
      </ul></li>
      <li><a name="toc-Advanced-certificate-verification-1" href="#Advanced-certificate-verification">4.1.3 Advanced certificate verification</a>
      <ul class="no-bullet">
        <li><a name="toc-Verifying-a-certificate-using-trust-on-first-use-authentication-1" href="#Verifying-a-certificate-using-trust-on-first-use-authentication">4.1.3.1 Verifying a certificate using trust on first use authentication</a></li>
        <li><a name="toc-Verifying-a-certificate-using-DANE-_0028DNSSEC_0029" href="#Verifying-a-certificate-using-DANE">4.1.3.2 Verifying a certificate using DANE (DNSSEC)</a></li>
      </ul></li>
      <li><a name="toc-Digital-signatures-1" href="#Digital-signatures">4.1.4 Digital signatures</a>
      <ul class="no-bullet">
        <li><a name="toc-Trading-security-for-interoperability" href="#Trading-security-for-interoperability">4.1.4.1 Trading security for interoperability</a></li>
      </ul></li>
    </ul></li>
    <li><a name="toc-More-on-certificate-authentication-1" href="#More-on-certificate-authentication">4.2 More on certificate authentication</a>
    <ul class="no-bullet">
      <li><a name="toc-PKCS-_002310-certificate-requests" href="#PKCS-10-certificate-requests">4.2.1 <acronym>PKCS</acronym> #10 certificate requests</a></li>
      <li><a name="toc-PKIX-certificate-revocation-lists-1" href="#PKIX-certificate-revocation-lists">4.2.2 PKIX certificate revocation lists</a></li>
      <li><a name="toc-OCSP-certificate-status-checking-1" href="#OCSP-certificate-status-checking">4.2.3 <acronym>OCSP</acronym> certificate status checking</a></li>
      <li><a name="toc-Managing-encrypted-keys-1" href="#Managing-encrypted-keys">4.2.4 Managing encrypted keys</a></li>
      <li><a name="toc-Invoking-certtool" href="#certtool-Invocation">4.2.5 Invoking certtool</a></li>
      <li><a name="toc-Invoking-ocsptool" href="#ocsptool-Invocation">4.2.6 Invoking ocsptool</a></li>
      <li><a name="toc-Invoking-danetool" href="#danetool-Invocation">4.2.7 Invoking danetool</a></li>
    </ul></li>
    <li><a name="toc-Shared_002dkey-and-anonymous-authentication-1" href="#Shared_002dkey-and-anonymous-authentication">4.3 Shared-key and anonymous authentication</a>
    <ul class="no-bullet">
      <li><a name="toc-SRP-authentication-1" href="#SRP-authentication">4.3.1 SRP authentication</a>
      <ul class="no-bullet">
        <li><a name="toc-Authentication-using-SRP-1" href="#Authentication-using-SRP">4.3.1.1 Authentication using <acronym>SRP</acronym></a></li>
        <li><a name="toc-Invoking-srptool" href="#srptool-Invocation">4.3.1.2 Invoking srptool</a></li>
      </ul></li>
      <li><a name="toc-PSK-authentication-1" href="#PSK-authentication">4.3.2 PSK authentication</a>
      <ul class="no-bullet">
        <li><a name="toc-Authentication-using-PSK-1" href="#Authentication-using-PSK">4.3.2.1 Authentication using <acronym>PSK</acronym></a></li>
        <li><a name="toc-Invoking-psktool" href="#psktool-Invocation">4.3.2.2 Invoking psktool</a></li>
      </ul></li>
      <li><a name="toc-Anonymous-authentication-1" href="#Anonymous-authentication">4.3.3 Anonymous authentication</a></li>
    </ul></li>
    <li><a name="toc-Selecting-an-appropriate-authentication-method-1" href="#Selecting-an-appropriate-authentication-method">4.4 Selecting an appropriate authentication method</a>
    <ul class="no-bullet">
      <li><a name="toc-Two-peers-with-an-out_002dof_002dband-channel" href="#Two-peers-with-an-out_002dof_002dband-channel">4.4.1 Two peers with an out-of-band channel</a></li>
      <li><a name="toc-Two-peers-without-an-out_002dof_002dband-channel" href="#Two-peers-without-an-out_002dof_002dband-channel">4.4.2 Two peers without an out-of-band channel</a></li>
      <li><a name="toc-Two-peers-and-a-trusted-third-party" href="#Two-peers-and-a-trusted-third-party">4.4.3 Two peers and a trusted third party</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-Hardware-security-modules-and-abstract-key-types-1" href="#Hardware-security-modules-and-abstract-key-types">5 Hardware security modules and abstract key types</a>
  <ul class="no-bullet">
    <li><a name="toc-Abstract-key-types-1" href="#Abstract-key-types">5.1 Abstract key types</a>
    <ul class="no-bullet">
      <li><a name="toc-Public-keys" href="#Abstract-public-keys">5.1.1 Public keys</a></li>
      <li><a name="toc-Private-keys" href="#Abstract-private-keys">5.1.2 Private keys</a></li>
      <li><a name="toc-Operations-1" href="#Operations">5.1.3 Operations</a></li>
    </ul></li>
    <li><a name="toc-Smart-cards-and-HSMs-1" href="#Smart-cards-and-HSMs">5.2 Smart cards and HSMs</a>
    <ul class="no-bullet">
      <li><a name="toc-Initialization-1" href="#PKCS11-Initialization">5.2.1 Initialization</a></li>
      <li><a name="toc-Accessing-objects-that-require-a-PIN-1" href="#Accessing-objects-that-require-a-PIN">5.2.2 Accessing objects that require a PIN</a></li>
      <li><a name="toc-Reading-objects-1" href="#Reading-objects">5.2.3 Reading objects</a></li>
      <li><a name="toc-Writing-objects-1" href="#Writing-objects">5.2.4 Writing objects</a></li>
      <li><a name="toc-Using-a-PKCS-_002311-token-with-TLS" href="#Using-a-PKCS11-token-with-TLS">5.2.5 Using a <acronym>PKCS</acronym> #11 token with TLS</a></li>
      <li><a name="toc-Invoking-p11tool" href="#p11tool-Invocation">5.2.6 Invoking p11tool</a></li>
    </ul></li>
    <li><a name="toc-Trusted-Platform-Module-_0028TPM_0029" href="#Trusted-Platform-Module">5.3 Trusted Platform Module (TPM)</a>
    <ul class="no-bullet">
      <li><a name="toc-Keys-in-TPM-1" href="#Keys-in-TPM">5.3.1 Keys in TPM</a></li>
      <li><a name="toc-Key-generation-1" href="#Key-generation">5.3.2 Key generation</a></li>
      <li><a name="toc-Using-keys-1" href="#Using-keys">5.3.3 Using keys</a></li>
      <li><a name="toc-Invoking-tpmtool" href="#tpmtool-Invocation">5.3.4 Invoking tpmtool</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-How-to-use-GnuTLS-in-applications-1" href="#How-to-use-GnuTLS-in-applications">6 How to use <acronym>GnuTLS</acronym> in applications</a>
  <ul class="no-bullet">
    <li><a name="toc-Introduction" href="#Introduction-to-the-library">6.1 Introduction</a>
    <ul class="no-bullet">
      <li><a name="toc-General-idea-1" href="#General-idea">6.1.1 General idea</a></li>
      <li><a name="toc-Error-handling-1" href="#Error-handling">6.1.2 Error handling</a></li>
      <li><a name="toc-Common-types-1" href="#Common-types">6.1.3 Common types</a></li>
      <li><a name="toc-Debugging-and-auditing-1" href="#Debugging-and-auditing">6.1.4 Debugging and auditing</a></li>
      <li><a name="toc-Thread-safety-1" href="#Thread-safety">6.1.5 Thread safety</a></li>
      <li><a name="toc-Callback-functions-1" href="#Callback-functions">6.1.6 Callback functions</a></li>
    </ul></li>
    <li><a name="toc-Preparation-1" href="#Preparation">6.2 Preparation</a>
    <ul class="no-bullet">
      <li><a name="toc-Headers-1" href="#Headers">6.2.1 Headers</a></li>
      <li><a name="toc-Initialization-2" href="#Initialization">6.2.2 Initialization</a></li>
      <li><a name="toc-Version-check-1" href="#Version-check">6.2.3 Version check</a></li>
      <li><a name="toc-Building-the-source-1" href="#Building-the-source">6.2.4 Building the source</a></li>
    </ul></li>
    <li><a name="toc-Session-initialization-1" href="#Session-initialization">6.3 Session initialization</a></li>
    <li><a name="toc-Associating-the-credentials-1" href="#Associating-the-credentials">6.4 Associating the credentials</a>
    <ul class="no-bullet">
      <li><a name="toc-Certificates" href="#Certificate-credentials">6.4.1 Certificates</a></li>
      <li><a name="toc-SRP" href="#SRP-credentials">6.4.2 SRP</a></li>
      <li><a name="toc-PSK" href="#PSK-credentials">6.4.3 PSK</a></li>
      <li><a name="toc-Anonymous" href="#Anonymous-credentials">6.4.4 Anonymous</a></li>
    </ul></li>
    <li><a name="toc-Setting-up-the-transport-layer-1" href="#Setting-up-the-transport-layer">6.5 Setting up the transport layer</a>
    <ul class="no-bullet">
      <li><a name="toc-Asynchronous-operation-1" href="#Asynchronous-operation">6.5.1 Asynchronous operation</a></li>
      <li><a name="toc-DTLS-sessions-1" href="#DTLS-sessions">6.5.2 DTLS sessions</a></li>
    </ul></li>
    <li><a name="toc-TLS-handshake-1" href="#TLS-handshake">6.6 TLS handshake</a></li>
    <li><a name="toc-Data-transfer-and-termination-1" href="#Data-transfer-and-termination">6.7 Data transfer and termination</a></li>
    <li><a name="toc-Buffered-data-transfer-1" href="#Buffered-data-transfer">6.8 Buffered data transfer</a></li>
    <li><a name="toc-Handling-alerts-1" href="#Handling-alerts">6.9 Handling alerts</a></li>
    <li><a name="toc-Priority-strings" href="#Priority-Strings">6.10 Priority strings</a></li>
    <li><a name="toc-Selecting-cryptographic-key-sizes-1" href="#Selecting-cryptographic-key-sizes">6.11 Selecting cryptographic key sizes</a></li>
    <li><a name="toc-Advanced-topics-1" href="#Advanced-topics">6.12 Advanced topics</a>
    <ul class="no-bullet">
      <li><a name="toc-Session-resumption-1" href="#Session-resumption">6.12.1 Session resumption</a></li>
      <li><a name="toc-Certificate-verification-1" href="#Certificate-verification">6.12.2 Certificate verification</a>
      <ul class="no-bullet">
        <li><a name="toc-Trust-on-first-use" href="#Trust-on-first-use">6.12.2.1 Trust on first use</a></li>
        <li><a name="toc-DANE-verification" href="#DANE-verification">6.12.2.2 DANE verification</a></li>
      </ul></li>
      <li><a name="toc-Parameter-generation-1" href="#Parameter-generation">6.12.3 Parameter generation</a></li>
      <li><a name="toc-Keying-material-exporters" href="#Keying-Material-Exporters">6.12.4 Keying material exporters</a></li>
      <li><a name="toc-Channel-bindings" href="#Channel-Bindings">6.12.5 Channel bindings</a></li>
      <li><a name="toc-Interoperability-1" href="#Interoperability">6.12.6 Interoperability</a></li>
      <li><a name="toc-Compatibility-with-the-OpenSSL-library-1" href="#Compatibility-with-the-OpenSSL-library">6.12.7 Compatibility with the OpenSSL library</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-GnuTLS-application-examples-1" href="#GnuTLS-application-examples">7 GnuTLS application examples</a>
  <ul class="no-bullet">
    <li><a name="toc-Client-examples-1" href="#Client-examples">7.1 Client examples</a>
    <ul class="no-bullet">
      <li><a name="toc-Simple-client-example-with-X_002e509-certificate-support-1" href="#Simple-client-example-with-X_002e509-certificate-support">7.1.1 Simple client example with <acronym>X.509</acronym> certificate support</a></li>
      <li><a name="toc-Simple-client-example-with-SSH_002dstyle-certificate-verification-1" href="#Simple-client-example-with-SSH_002dstyle-certificate-verification">7.1.2 Simple client example with SSH-style certificate verification</a></li>
      <li><a name="toc-Simple-client-example-with-anonymous-authentication-1" href="#Simple-client-example-with-anonymous-authentication">7.1.3 Simple client example with anonymous authentication</a></li>
      <li><a name="toc-Simple-datagram-TLS-client-example" href="#Simple-Datagram-TLS-client-example">7.1.4 Simple datagram <acronym>TLS</acronym> client example</a></li>
      <li><a name="toc-Obtaining-session-information-1" href="#Obtaining-session-information">7.1.5 Obtaining session information</a></li>
      <li><a name="toc-Using-a-callback-to-select-the-certificate-to-use-1" href="#Using-a-callback-to-select-the-certificate-to-use">7.1.6 Using a callback to select the certificate to use</a></li>
      <li><a name="toc-Verifying-a-certificate-1" href="#Verifying-a-certificate">7.1.7 Verifying a certificate</a></li>
      <li><a name="toc-Using-a-smart-card-with-TLS" href="#Client-using-a-smart-card-with-TLS">7.1.8 Using a smart card with TLS</a></li>
      <li><a name="toc-Client-with-resume-capability-example" href="#Client-with-Resume-capability-example">7.1.9 Client with resume capability example</a></li>
      <li><a name="toc-Simple-client-example-with-SRP-authentication-1" href="#Simple-client-example-with-SRP-authentication">7.1.10 Simple client example with <acronym>SRP</acronym> authentication</a></li>
      <li><a name="toc-Simple-client-example-using-the-C_002b_002b-API" href="#Simple-client-example-in-C_002b_002b">7.1.11 Simple client example using the C++ API</a></li>
      <li><a name="toc-Helper-functions-for-TCP-connections-1" href="#Helper-functions-for-TCP-connections">7.1.12 Helper functions for TCP connections</a></li>
      <li><a name="toc-Helper-functions-for-UDP-connections-1" href="#Helper-functions-for-UDP-connections">7.1.13 Helper functions for UDP connections</a></li>
    </ul></li>
    <li><a name="toc-Server-examples-1" href="#Server-examples">7.2 Server examples</a>
    <ul class="no-bullet">
      <li><a name="toc-Echo-server-with-X_002e509-authentication-1" href="#Echo-server-with-X_002e509-authentication">7.2.1 Echo server with <acronym>X.509</acronym> authentication</a></li>
      <li><a name="toc-Echo-server-with-OpenPGP-authentication-1" href="#Echo-server-with-OpenPGP-authentication">7.2.2 Echo server with <acronym>OpenPGP</acronym> authentication</a></li>
      <li><a name="toc-Echo-server-with-SRP-authentication-1" href="#Echo-server-with-SRP-authentication">7.2.3 Echo server with <acronym>SRP</acronym> authentication</a></li>
      <li><a name="toc-Echo-server-with-anonymous-authentication-1" href="#Echo-server-with-anonymous-authentication">7.2.4 Echo server with anonymous authentication</a></li>
      <li><a name="toc-DTLS-echo-server-with-X_002e509-authentication-1" href="#DTLS-echo-server-with-X_002e509-authentication">7.2.5 DTLS echo server with <acronym>X.509</acronym> authentication</a></li>
    </ul></li>
    <li><a name="toc-OCSP-example-1" href="#OCSP-example">7.3 OCSP example</a></li>
    <li><a name="toc-Miscellaneous-examples-1" href="#Miscellaneous-examples">7.4 Miscellaneous examples</a>
    <ul class="no-bullet">
      <li><a name="toc-Checking-for-an-alert-1" href="#Checking-for-an-alert">7.4.1 Checking for an alert</a></li>
      <li><a name="toc-X_002e509-certificate-parsing-example-1" href="#X_002e509-certificate-parsing-example">7.4.2 <acronym>X.509</acronym> certificate parsing example</a></li>
      <li><a name="toc-Listing-the-ciphersuites-in-a-priority-string-1" href="#Listing-the-ciphersuites-in-a-priority-string">7.4.3 Listing the ciphersuites in a priority string</a></li>
      <li><a name="toc-PKCS-_002312-structure-generation-example" href="#PKCS12-structure-generation-example">7.4.4 PKCS #12 structure generation example</a></li>
    </ul></li>
    <li><a name="toc-XSSL-examples-1" href="#XSSL-examples">7.5 XSSL examples</a>
    <ul class="no-bullet">
      <li><a name="toc-Example-client-with-X_002e509-certificate-authentication-1" href="#Example-client-with-X_002e509-certificate-authentication">7.5.1 Example client with X.509 certificate authentication</a></li>
      <li><a name="toc-Example-client-with-X_002e509-certificate-authentication-and-TOFU-1" href="#Example-client-with-X_002e509-certificate-authentication-and-TOFU">7.5.2 Example client with X.509 certificate authentication and TOFU</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-Using-GnuTLS-as-a-cryptographic-library-1" href="#Using-GnuTLS-as-a-cryptographic-library">8 Using GnuTLS as a cryptographic library</a>
  <ul class="no-bullet">
    <li><a name="toc-Symmetric-algorithms-1" href="#Symmetric-algorithms">8.1 Symmetric algorithms</a></li>
    <li><a name="toc-Public-key-algorithms-1" href="#Public-key-algorithms">8.2 Public key algorithms</a></li>
    <li><a name="toc-Hash-and-HMAC-functions-1" href="#Hash-and-HMAC-functions">8.3 Hash and HMAC functions</a></li>
    <li><a name="toc-Random-number-generation-1" href="#Random-number-generation">8.4 Random number generation</a></li>
  </ul></li>
  <li><a name="toc-Other-included-programs-1" href="#Other-included-programs">9 Other included programs</a>
  <ul class="no-bullet">
    <li><a name="toc-Invoking-gnutls_002dcli" href="#gnutls_002dcli-Invocation">9.1 Invoking gnutls-cli</a></li>
    <li><a name="toc-Invoking-gnutls_002dserv" href="#gnutls_002dserv-Invocation">9.2 Invoking gnutls-serv</a></li>
    <li><a name="toc-Invoking-gnutls_002dcli_002ddebug" href="#gnutls_002dcli_002ddebug-Invocation">9.3 Invoking gnutls-cli-debug</a></li>
  </ul></li>
  <li><a name="toc-Internal-Architecture-of-GnuTLS" href="#Internal-architecture-of-GnuTLS">10 Internal Architecture of GnuTLS</a>
  <ul class="no-bullet">
    <li><a name="toc-The-TLS-Protocol-1" href="#The-TLS-Protocol">10.1 The TLS Protocol</a></li>
    <li><a name="toc-TLS-Handshake-Protocol-1" href="#TLS-Handshake-Protocol">10.2 TLS Handshake Protocol</a></li>
    <li><a name="toc-TLS-Authentication-Methods-1" href="#TLS-Authentication-Methods">10.3 TLS Authentication Methods</a></li>
    <li><a name="toc-TLS-Extension-Handling-1" href="#TLS-Extension-Handling">10.4 TLS Extension Handling</a></li>
    <li><a name="toc-Cryptographic-Backend-1" href="#Cryptographic-Backend">10.5 Cryptographic Backend</a></li>
  </ul></li>
  <li><a name="toc-Upgrading-from-previous-versions-1" href="#Upgrading-from-previous-versions">Appendix A Upgrading from previous versions</a></li>
  <li><a name="toc-Support-1" href="#Support">Appendix B Support</a>
  <ul class="no-bullet">
    <li><a name="toc-Getting-Help" href="#Getting-help">B.1 Getting Help</a></li>
    <li><a name="toc-Commercial-Support-1" href="#Commercial-Support">B.2 Commercial Support</a></li>
    <li><a name="toc-Bug-Reports-1" href="#Bug-Reports">B.3 Bug Reports</a></li>
    <li><a name="toc-Contributing-1" href="#Contributing">B.4 Contributing</a></li>
  </ul></li>
  <li><a name="toc-Error-Codes-and-Descriptions" href="#Error-codes">Appendix C Error Codes and Descriptions</a></li>
  <li><a name="toc-Supported-Ciphersuites" href="#Supported-ciphersuites">Appendix D Supported Ciphersuites</a></li>
  <li><a name="toc-API-reference-1" href="#API-reference">Appendix E API reference</a>
  <ul class="no-bullet">
    <li><a name="toc-Core-TLS-API-1" href="#Core-TLS-API">E.1 Core TLS API</a></li>
    <li><a name="toc-High-level-TLS-API-1" href="#High-level-TLS-API">E.2 High level TLS API</a></li>
    <li><a name="toc-Datagram-TLS-API-1" href="#Datagram-TLS-API">E.3 Datagram TLS API</a></li>
    <li><a name="toc-X_002e509-certificate-API" href="#X509-certificate-API">E.4 <acronym>X.509</acronym> certificate API</a></li>
    <li><a name="toc-OCSP-API-1" href="#OCSP-API">E.5 <acronym>OCSP</acronym> API</a></li>
    <li><a name="toc-OpenPGP-API-1" href="#OpenPGP-API">E.6 <acronym>OpenPGP</acronym> API</a></li>
    <li><a name="toc-PKCS-12-API-1" href="#PKCS-12-API">E.7 PKCS 12 API</a></li>
    <li><a name="toc-Hardware-token-via-PKCS-11-API" href="#PKCS-11-API">E.8 Hardware token via PKCS 11 API</a></li>
    <li><a name="toc-TPM-API-1" href="#TPM-API">E.9 TPM API</a></li>
    <li><a name="toc-Abstract-key-API-1" href="#Abstract-key-API">E.10 Abstract key API</a></li>
    <li><a name="toc-DANE-API-1" href="#DANE-API">E.11 DANE API</a></li>
    <li><a name="toc-Cryptographic-API-1" href="#Cryptographic-API">E.12 Cryptographic API</a></li>
    <li><a name="toc-Compatibility-API-1" href="#Compatibility-API">E.13 Compatibility API</a></li>
  </ul></li>
  <li><a name="toc-Copying-Information-1" href="#Copying-Information">Appendix F Copying Information</a></li>
  <li><a name="toc-Bibliography-1" href="#Bibliography">Bibliography</a></li>
  <li><a name="toc-Function-and-Data-Index-1" href="#Function-and-Data-Index">Function and Data Index</a></li>
  <li><a name="toc-Concept-Index-1" href="#Concept-Index">Concept Index</a></li>
</ul>
</div>


<a name="Top"></a>
<div class="header">
<p>
Next: <a href="#Preface" accesskey="n" rel="next">Preface</a>, Up: <a href="dir.html#Top" accesskey="u" rel="up">(dir)</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="GnuTLS"></a>
<h1 class="top">GnuTLS</h1>

<p>This manual is last updated 24 April 2013 for version
3.2.0 of GnuTLS.
</p>
<p>Copyright &copy; 2001-2013 Free Software Foundation, Inc.\\
Copyright &copy; 2001-2013 Nikos Mavrogiannopoulos
</p>
<blockquote>
<p>Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.  A
copy of the license is included in the section entitled &ldquo;GNU Free
Documentation License&rdquo;.
</p></blockquote>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Preface" accesskey="1">Preface</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Introduction-to-GnuTLS" accesskey="2">Introduction to GnuTLS</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Introduction-to-TLS" accesskey="3">Introduction to TLS</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authentication-methods" accesskey="4">Authentication methods</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Hardware-security-modules-and-abstract-key-types" accesskey="5">Hardware security modules and abstract key types</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#How-to-use-GnuTLS-in-applications" accesskey="6">How to use GnuTLS in applications</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#GnuTLS-application-examples" accesskey="7">GnuTLS application examples</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Using-GnuTLS-as-a-cryptographic-library" accesskey="8">Using GnuTLS as a cryptographic library</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Other-included-programs" accesskey="9">Other included programs</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Internal-architecture-of-GnuTLS">Internal architecture of GnuTLS</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Upgrading-from-previous-versions">Upgrading from previous versions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Support">Support</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Error-codes">Error codes</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Supported-ciphersuites">Supported ciphersuites</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#API-reference">API reference</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Copying-Information">Copying Information</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Bibliography">Bibliography</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Function-and-Data-Index">Function and Data Index</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Concept-Index">Concept Index</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="Preface"></a>
<div class="header">
<p>
Next: <a href="#Introduction-to-GnuTLS" accesskey="n" rel="next">Introduction to GnuTLS</a>, Previous: <a href="#Top" accesskey="p" rel="previous">Top</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Preface-1"></a>
<h2 class="chapter">1 Preface</h2>

<p>This document demonstrates and explains the <acronym>GnuTLS</acronym>
library API.  A brief introduction to the protocols and the technology
involved is also included so that an application programmer can
better understand the <acronym>GnuTLS</acronym> purpose and actual offerings.
Even if <acronym>GnuTLS</acronym> is a typical library software, it operates
over several security and cryptographic protocols which require the
programmer to make careful and correct usage of them. Otherwise it
is likely to only obtain a false sense of security.
The term of security is very broad even if restricted to computer
software, and cannot be confined to a single cryptographic
library.  For that reason, do not consider any program secure just
because it uses <acronym>GnuTLS</acronym>; there are several ways to compromise
a program or a communication line and <acronym>GnuTLS</acronym> only helps with
some of them.
</p>
<p>Although this document tries to be self contained, basic network
programming and public key infrastructure (PKI) knowledge is assumed 
in most of it. A good introduction to networking can be found 
in [<em>STEVENS</em>], to public key infrastructure in [<em>GUTPKI</em>]
and to security engineering in [<em>ANDERSON</em>].
</p>
<p>Updated versions of the <acronym>GnuTLS</acronym> software and this document
will be available from <a href="http://www.gnutls.org/">http://www.gnutls.org/</a> and
<a href="http://www.gnu.org/software/gnutls/">http://www.gnu.org/software/gnutls/</a>.
</p>

<hr>
<a name="Introduction-to-GnuTLS"></a>
<div class="header">
<p>
Next: <a href="#Introduction-to-TLS" accesskey="n" rel="next">Introduction to TLS</a>, Previous: <a href="#Preface" accesskey="p" rel="previous">Preface</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Introduction-to-GnuTLS-1"></a>
<h2 class="chapter">2 Introduction to GnuTLS</h2>

<p>In brief <acronym>GnuTLS</acronym> can be described as a library which offers an API
to access secure communication protocols. These protocols provide
privacy over insecure lines, and were designed to prevent
eavesdropping, tampering, or message forgery.
</p>
<p>Technically <acronym>GnuTLS</acronym> is a portable ANSI C based library which
implements the protocols ranging from SSL 3.0 to TLS 1.2 (see <a href="#Introduction-to-TLS">Introduction to TLS</a>, 
for a detailed description of the protocols), accompanied
with the required framework for authentication and public key
infrastructure.  Important features of the <acronym>GnuTLS</acronym> library
include:
</p>
<ul>
<li> Support for TLS 1.2, TLS 1.1, TLS 1.0 and SSL 3.0 protocols.

</li><li> Support for Datagram TLS 1.0 and 1.2.

</li><li> Support for handling and verification of <acronym>X.509</acronym> and <acronym>OpenPGP</acronym> certificates.

</li><li> Support for password authentication using <acronym>TLS-SRP</acronym>.

</li><li> Support for keyed authentication using <acronym>TLS-PSK</acronym>.

</li><li> Support for TPM, <acronym>PKCS</acronym> #11 tokens and smart-cards.

</li></ul>

<p>The <acronym>GnuTLS</acronym> library consists of three independent parts, namely the &ldquo;TLS
protocol part&rdquo;, the &ldquo;Certificate part&rdquo;, and the &ldquo;Cryptographic
back-end&rdquo; part.  The &ldquo;TLS protocol part&rdquo; is the actual protocol
implementation, and is entirely implemented within the
<acronym>GnuTLS</acronym> library.  The &ldquo;Certificate part&rdquo; consists of the
certificate parsing, and verification functions and it uses
functionality from the
libtasn1 library.
The &ldquo;Cryptographic back-end&rdquo; is provided by the nettle
and gmplib libraries.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Downloading-and-installing" accesskey="1">Downloading and installing</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Document-overview" accesskey="2">Document overview</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="Downloading-and-installing"></a>
<div class="header">
<p>
Next: <a href="#Document-overview" accesskey="n" rel="next">Document overview</a>, Up: <a href="#Introduction-to-GnuTLS" accesskey="u" rel="up">Introduction to GnuTLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Downloading-and-installing-1"></a>
<h3 class="section">2.1 Downloading and installing</h3>
<a name="index-installation"></a>
<a name="index-download"></a>

<p>GnuTLS is available for download at:
<a href="http://www.gnutls.org/download.html">http://www.gnutls.org/download.html</a>
</p>
<p>GnuTLS uses a development cycle where even minor version numbers
indicate a stable release and a odd minor version number indicate a
development release.  For example, GnuTLS 1.6.3 denote a stable
release since 6 is even, and GnuTLS 1.7.11 denote a development
release since 7 is odd.
</p>
<p>GnuTLS depends on <code>nettle</code> and <code>gmplib</code>, and you will need to install it
before installing GnuTLS.  The <code>nettle</code> library is available from
<a href="http://www.lysator.liu.se/~nisse/nettle/">http://www.lysator.liu.se/~nisse/nettle/</a>, while <code>gmplib</code> is available
from <a href="http://www.gmplib.org/">http://www.gmplib.org/</a>.
Don&rsquo;t forget to verify the cryptographic signature after downloading
source code packages.
</p>
<p>The package is then extracted, configured and built like many other
packages that use Autoconf.  For detailed information on configuring
and building it, refer to the <samp>INSTALL</samp> file that is part of the
distribution archive.  Typically you invoke <code>./configure</code> and
then <code>make check install</code>.  There are a number of compile-time
parameters, as discussed below.
</p>
<p>Several parts of GnuTLS require ASN.1 functionality, which is provided by 
a library called libtasn1.  A copy of libtasn1 is included in GnuTLS.  If you
want to install it separately (e.g., to make it possibly to use
libtasn1 in other programs), you can get it from
<a href="http://www.gnu.org/software/libtasn1/">http://www.gnu.org/software/libtasn1/</a>.
</p>
<p>The compression library, <code>libz</code>, the PKCS #11 helper library <code>p11-kit</code>, as well
as the TPM library <code>trousers</code>, are 
optional dependencies. You may get libz from <a href="http://www.zlib.net/">http://www.zlib.net/</a>, 
p11-kit from <a href="http://p11-glue.freedesktop.org/">http://p11-glue.freedesktop.org/</a> and trousers from
<a href="http://trousers.sourceforge.net/">http://trousers.sourceforge.net/</a>.
</p>
<p>A few <code>configure</code> options may be relevant, summarized below.
They disable or enable particular features,
to create a smaller library with only the required features.
Note however, that although a smaller library is generated, the
included programs are not guarranteed to compile if some of these
options are given.
</p>
<pre class="verbatim">--disable-srp-authentication
--disable-psk-authentication
--disable-anon-authentication
--disable-dhe
--disable-ecdhe
--disable-rsa-export
--disable-extra-pki
--disable-openpgp-authentication
--disable-openssl-compatibility
--disable-libdane
--without-p11-kit
--with-tpm
--disable-dtls-srtp-support
</pre>
<p>For the complete list, refer to the output from <code>configure --help</code>.
</p>
<hr>
<a name="Document-overview"></a>
<div class="header">
<p>
Previous: <a href="#Downloading-and-installing" accesskey="p" rel="previous">Downloading and installing</a>, Up: <a href="#Introduction-to-GnuTLS" accesskey="u" rel="up">Introduction to GnuTLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Overview"></a>
<h3 class="section">2.2 Overview</h3>
<p>In this document we present an overview of the supported security protocols in <a href="#Introduction-to-TLS">Introduction to TLS</a>, and 
continue by providing more information on the certificate authentication in <a href="#Certificate-authentication">Certificate authentication</a>,
and shared-key as well anonymous authentication in <a href="#Shared_002dkey-and-anonymous-authentication">Shared-key and anonymous authentication</a>. We
elaborate on certificate authentication by demonstrating advanced usage of the API in <a href="#More-on-certificate-authentication">More on certificate authentication</a>.
The core of the TLS library is presented in <a href="#How-to-use-GnuTLS-in-applications">How to use GnuTLS in applications</a> and example
applications are listed in <a href="#GnuTLS-application-examples">GnuTLS application examples</a>.
In <a href="#Other-included-programs">Other included programs</a> the usage of few included programs that
may assist debugging is presented. The last chapter is <a href="#Internal-architecture-of-GnuTLS">Internal architecture of GnuTLS</a> that
provides a short introduction to GnuTLS&rsquo; internal architecture.
</p>
<hr>
<a name="Introduction-to-TLS"></a>
<div class="header">
<p>
Next: <a href="#Authentication-methods" accesskey="n" rel="next">Authentication methods</a>, Previous: <a href="#Introduction-to-GnuTLS" accesskey="p" rel="previous">Introduction to GnuTLS</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Introduction-to-TLS-and-DTLS"></a>
<h2 class="chapter">3 Introduction to <acronym>TLS</acronym> and <acronym>DTLS</acronym></h2>

<p><acronym>TLS</acronym> stands for &ldquo;Transport Layer Security&rdquo; and is the
successor of SSL, the Secure Sockets Layer protocol [<em>SSL3</em>]
designed by Netscape.  <acronym>TLS</acronym> is an Internet protocol, defined
by <acronym>IETF</acronym><a name="DOCF1" href="#FOOT1"><sup>1</sup></a>, described in [<em>RFC5246</em>].  
The protocol provides
confidentiality, and authentication layers over any reliable transport
layer.  The description, above, refers to <acronym>TLS</acronym> 1.0 but applies
to all other TLS versions as the differences between the protocols are not major.  
</p>
<p>The <acronym>DTLS</acronym> protocol, or &ldquo;Datagram <acronym>TLS</acronym>&rdquo; [<em>RFC4347</em>] is a
protocol with identical goals as <acronym>TLS</acronym>, but can operate
under unreliable transport layers such as <acronym>UDP</acronym>. The
discussions below apply to this protocol as well, except when
noted otherwise.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#TLS-layers" accesskey="1">TLS layers</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-transport-layer" accesskey="2">The transport layer</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-TLS-record-protocol" accesskey="3">The TLS record protocol</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-TLS-Alert-Protocol" accesskey="4">The TLS Alert Protocol</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#The-TLS-Handshake-Protocol" accesskey="5">The TLS Handshake Protocol</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#TLS-Extensions" accesskey="6">TLS Extensions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#How-to-use-TLS-in-application-protocols" accesskey="7">How to use TLS in application protocols</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#On-SSL-2-and-older-protocols" accesskey="8">On SSL 2 and older protocols</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="TLS-layers"></a>
<div class="header">
<p>
Next: <a href="#The-transport-layer" accesskey="n" rel="next">The transport layer</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="TLS-layers-1"></a>
<h3 class="section">3.1 TLS layers</h3>
<a name="index-TLS-layers"></a>

<p><acronym>TLS</acronym> is a layered protocol, and consists of the record
protocol, the handshake protocol and the alert protocol. The record
protocol is to serve all other protocols and is above the transport
layer.  The record protocol offers symmetric encryption, data
authenticity, and optionally compression.
The alert protocol offers some signaling to the other protocols. It
can help informing the peer for the cause of failures and other error
conditions.  See <a href="#The-Alert-Protocol">The Alert Protocol</a>, for more information.  The
alert protocol is above the record protocol.
</p>
<p>The handshake protocol is responsible for the security parameters&rsquo;
negotiation, the initial key exchange and authentication.  
See <a href="#The-Handshake-Protocol">The Handshake Protocol</a>, for more information about the handshake
protocol.  The protocol layering in TLS is shown in <a href="#fig_003atls_002dlayers">Figure 3.1</a>.
</p>
<div class="float"><a name="fig_003atls_002dlayers"></a>
<img src="gnutls-layers.png" alt="gnutls-layers">

<div class="float-caption"><p><strong>Figure 3.1: </strong>The TLS protocol layers.</p></div></div>
<hr>
<a name="The-transport-layer"></a>
<div class="header">
<p>
Next: <a href="#The-TLS-record-protocol" accesskey="n" rel="next">The TLS record protocol</a>, Previous: <a href="#TLS-layers" accesskey="p" rel="previous">TLS layers</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-transport-layer-1"></a>
<h3 class="section">3.2 The transport layer</h3>
<a name="index-transport-protocol"></a>
<a name="index-transport-layer"></a>

<p><acronym>TLS</acronym> is not limited to any transport layer and can be used
above any transport layer, as long as it is a reliable one.  <acronym>DTLS</acronym>
can be used over reliable and unreliable transport layers.
<acronym>GnuTLS</acronym> supports TCP and UDP layers transparently using
the Berkeley sockets API. However, any transport layer can be used
by providing callbacks for <acronym>GnuTLS</acronym> to access the transport layer 
(for details see <a href="#Setting-up-the-transport-layer">Setting up the transport layer</a>).
</p>
<hr>
<a name="The-TLS-record-protocol"></a>
<div class="header">
<p>
Next: <a href="#The-TLS-Alert-Protocol" accesskey="n" rel="next">The TLS Alert Protocol</a>, Previous: <a href="#The-transport-layer" accesskey="p" rel="previous">The transport layer</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-TLS-record-protocol-1"></a>
<h3 class="section">3.3 The TLS record protocol</h3>
<a name="index-record-protocol"></a>

<p>The record protocol is the secure communications provider. Its purpose
is to encrypt, authenticate and &mdash;optionally&mdash; compress packets.
The record layer functions can be called at any time after
the handshake process is finished, when there is need to receive
or send data. In <acronym>DTLS</acronym> however, due to re-transmission
timers used in the handshake out-of-order handshake data might
be received for some time (maximum 60 seconds) after the handshake
process is finished. 
</p>
<p>The functions to access the record protocol are limited to send
and receive functions, which might, given 
the importance of this protocol in <acronym>TLS</acronym>, seem awkward.  This is because 
the record protocol&rsquo;s parameters are all set by the handshake protocol.
The record protocol initially starts with NULL parameters, which means
no encryption, and no MAC is used. Encryption and authentication begin
just after the handshake protocol has finished.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Encryption-algorithms-used-in-the-record-layer" accesskey="1">Encryption algorithms used in the record layer</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Compression-algorithms-used-in-the-record-layer" accesskey="2">Compression algorithms used in the record layer</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Weaknesses-and-countermeasures" accesskey="3">Weaknesses and countermeasures</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#On-Record-Padding" accesskey="4">On Record Padding</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="Encryption-algorithms-used-in-the-record-layer"></a>
<div class="header">
<p>
Next: <a href="#Compression-algorithms-used-in-the-record-layer" accesskey="n" rel="next">Compression algorithms used in the record layer</a>, Up: <a href="#The-TLS-record-protocol" accesskey="u" rel="up">The TLS record protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Encryption-algorithms-used-in-the-record-layer-1"></a>
<h4 class="subsection">3.3.1 Encryption algorithms used in the record layer</h4>
<a name="index-symmetric-encryption-algorithms"></a>

<p>Confidentiality in the record layer is achieved by using symmetric
block encryption algorithms like <code>3DES</code>, <code>AES</code>
or stream algorithms like <code>ARCFOUR_128</code>.
 Ciphers are encryption algorithms that use a single, secret,
key to encrypt and decrypt data. Block algorithms in CBC mode also provide
protection against statistical analysis of the data.  Thus, if you&rsquo;re
using the <acronym>TLS</acronym> protocol, a random number of blocks will be
appended to data, to prevent eavesdroppers from guessing the actual
data size.
</p>
<p>The supported in <acronym>GnuTLS</acronym> ciphers and MAC algorithms are shown in <a href="#tab_003aciphers">Table 3.1</a> and
<a href="#tab_003amacs">Table 3.2</a>.
</p>
<div class="float"><a name="tab_003aciphers"></a>
<table>
<thead><tr><th width="20%">Algorithm</th><th width="70%">Description</th></tr></thead>
<tr><td width="20%">3DES_CBC</td><td width="70%">This is the DES block cipher algorithm used with triple
encryption (EDE). Has 64 bits block size and is used in CBC mode.</td></tr>
<tr><td width="20%">ARCFOUR_128</td><td width="70%">ARCFOUR_128 is a compatible algorithm with RSA&rsquo;s RC4 algorithm, which is considered to be a trade
secret. It is a fast cipher but considered weak today.</td></tr>
<tr><td width="20%">ARCFOUR_40</td><td width="70%">This is the ARCFOUR cipher fed with a 40 bit key,
which is considered weak.</td></tr>
<tr><td width="20%">AES_CBC</td><td width="70%">AES or RIJNDAEL is the block cipher algorithm that replaces the old
DES algorithm.  Has 128 bits block size and is used in CBC mode.</td></tr>
<tr><td width="20%">AES_GCM</td><td width="70%">This is the AES algorithm in the authenticated encryption GCM mode.
This mode combines message authentication and encryption and can
be extremely fast on CPUs that support hardware acceleration.</td></tr>
<tr><td width="20%">CAMELLIA_CBC</td><td width="70%">This is an 128-bit block cipher developed by Mitsubishi and NTT. It
is one of the approved ciphers of the European NESSIE and Japanese
CRYPTREC projects.</td></tr>
</table>

<div class="float-caption"><p><strong>Table 3.1: </strong>Supported ciphers.</p></div></div>

<div class="float"><a name="tab_003amacs"></a>
<table>
<thead><tr><th width="20%">Algorithm</th><th width="70%">Description</th></tr></thead>
<tr><td width="20%">MAC_MD5</td><td width="70%">This is an HMAC based on MD5 a cryptographic hash algorithm designed 
by Ron Rivest. Outputs 128 bits of data.</td></tr>
<tr><td width="20%">MAC_SHA1</td><td width="70%">An HMAC based on the SHA1 cryptographic hash algorithm 
designed by NSA. Outputs 160 bits of data.</td></tr>
<tr><td width="20%">MAC_SHA256</td><td width="70%">An HMAC based on SHA256. Outputs 256 bits of data.</td></tr>
<tr><td width="20%">MAC_AEAD</td><td width="70%">This indicates that an authenticated encryption algorithm, such as
GCM, is in use.</td></tr>
</table>

<div class="float-caption"><p><strong>Table 3.2: </strong>Supported MAC algorithms.</p></div></div>

<hr>
<a name="Compression-algorithms-used-in-the-record-layer"></a>
<div class="header">
<p>
Next: <a href="#Weaknesses-and-countermeasures" accesskey="n" rel="next">Weaknesses and countermeasures</a>, Previous: <a href="#Encryption-algorithms-used-in-the-record-layer" accesskey="p" rel="previous">Encryption algorithms used in the record layer</a>, Up: <a href="#The-TLS-record-protocol" accesskey="u" rel="up">The TLS record protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Compression-algorithms-used-in-the-record-layer-1"></a>
<h4 class="subsection">3.3.2 Compression algorithms used in the record layer</h4>
<a name="index-compression-algorithms"></a>

<p>The TLS record layer also supports compression.  The algorithms
implemented in <acronym>GnuTLS</acronym> can be found in the table below.
The included algorithms perform really good when text, or other
compressible data are to be transferred, but offer nothing on already
compressed data, such as compressed images, zipped archives etc.
These compression algorithms, may be useful in high bandwidth TLS
tunnels, and in cases where network usage has to be minimized. It
should be noted however that compression increases latency.
</p>
<p>The record layer compression in <acronym>GnuTLS</acronym> is implemented based
on [<em>RFC3749</em>]. The supported algorithms are shown below.
</p>
<div class="float"><a name="gnutls_005fcompression_005fmethod_005ft"></a>


<dl compact="compact">
<dt><code>GNUTLS_COMP_UNKNOWN</code></dt>
<dd><p>Unknown compression method.
</p></dd>
<dt><code>GNUTLS_COMP_NULL</code></dt>
<dd><p>The NULL compression method (no compression).
</p></dd>
<dt><code>GNUTLS_COMP_DEFLATE</code></dt>
<dd><p>The DEFLATE compression method from zlib.
</p></dd>
<dt><code>GNUTLS_COMP_ZLIB</code></dt>
<dd><p>Same as <code>GNUTLS_COMP_DEFLATE</code> .
</p></dd>
</dl>

<div class="float-caption"><p><strong>Figure 3.2: </strong>Supported compression algorithms</p></div></div>
<p>Note that compression enables attacks such as traffic analysis, or even
plaintext recovery under certain circumstances. To avoid some of these
attacks GnuTLS allows each record to be compressed independently (i.e.,
stateless compression), by using the &quot;%STATELESS_COMPRESSION&quot; priority string,
in order to be used in cases where the attacker controlled data are
pt in separate records.
</p>
<hr>
<a name="Weaknesses-and-countermeasures"></a>
<div class="header">
<p>
Next: <a href="#On-Record-Padding" accesskey="n" rel="next">On Record Padding</a>, Previous: <a href="#Compression-algorithms-used-in-the-record-layer" accesskey="p" rel="previous">Compression algorithms used in the record layer</a>, Up: <a href="#The-TLS-record-protocol" accesskey="u" rel="up">The TLS record protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Weaknesses-and-countermeasures-1"></a>
<h4 class="subsection">3.3.3 Weaknesses and countermeasures</h4>

<p>Some weaknesses that may affect the security of the record layer have
been found in <acronym>TLS</acronym> 1.0 protocol. These weaknesses can be
exploited by active attackers, and exploit the facts that
</p>
<ol>
<li> <acronym>TLS</acronym> has separate alerts for &ldquo;decryption_failed&rdquo; and
&ldquo;bad_record_mac&rdquo;

</li><li> The decryption failure reason can be detected by timing the response
time.

</li><li> The IV for CBC encrypted packets is the last block of the previous
encrypted packet.

</li></ol>

<p>Those weaknesses were solved in <acronym>TLS</acronym> 1.1 [<em>RFC4346</em>]
which is implemented in <acronym>GnuTLS</acronym>. For this reason we suggest
to always negotiate the highest supported TLS version with the 
peer<a name="DOCF2" href="#FOOT2"><sup>2</sup></a>.
For a detailed discussion of the issues see the archives of the TLS 
Working Group mailing list and [<em>CBCATT</em>].
</p>
<hr>
<a name="On-Record-Padding"></a>
<div class="header">
<p>
Previous: <a href="#Weaknesses-and-countermeasures" accesskey="p" rel="previous">Weaknesses and countermeasures</a>, Up: <a href="#The-TLS-record-protocol" accesskey="u" rel="up">The TLS record protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="On-record-padding"></a>
<h4 class="subsection">3.3.4 On record padding</h4>
<a name="index-record-padding"></a>
<a name="index-bad_005frecord_005fmac"></a>

<p>The TLS protocol allows for extra padding of records in CBC ciphers, to prevent
statistical analysis based on the length of exchanged messages (see [<em>RFC5246</em>] section 6.2.3.2).  
GnuTLS appears to be one of few implementations that take advantage of this feature: 
the user can provide some plaintext data with a range of lengths she wishes to hide,
and GnuTLS adds extra padding to make sure the attacker cannot tell the real plaintext
length is in a range smaller than the user-provided one.
Use <a href="#gnutls_005frecord_005fsend_005frange">gnutls_record_send_range</a> to send length-hidden messages and
<a href="#gnutls_005frecord_005fcan_005fuse_005flength_005fhiding">gnutls_record_can_use_length_hiding</a> to check whether the current
session supports length hiding. Using the standard <a href="#gnutls_005frecord_005fsend">gnutls_record_send</a>
will only add minimal padding.
</p>
<p>The TLS implementation in the Symbian operating system, frequently
used by Nokia and Sony-Ericsson mobile phones, cannot handle
non-minimal record padding.  What happens when one of these clients
handshake with a GnuTLS server is that the client will fail to compute
the correct MAC for the record.  The client sends a TLS alert
(<code>bad_record_mac</code>) and disconnects.  Typically this will result
in error messages such as &rsquo;A TLS fatal alert has been received&rsquo;, &rsquo;Bad
record MAC&rsquo;, or both, on the GnuTLS server side.
</p>
<p>If compatibility with such devices is a concern, not sending length-hidden messages
solves the problem by using minimal padding.
</p>
<p>If you implement an application that have a configuration file, we
recommend that you make it possible for users or administrators to
specify a GnuTLS protocol priority string, which is used by your
application via <a href="#gnutls_005fpriority_005fset">gnutls_priority_set</a>.  To allow the best
flexibility, make it possible to have a different priority string for
different incoming IP addresses.
</p>

<hr>
<a name="The-TLS-Alert-Protocol"></a>
<div class="header">
<p>
Next: <a href="#The-TLS-Handshake-Protocol" accesskey="n" rel="next">The TLS Handshake Protocol</a>, Previous: <a href="#The-TLS-record-protocol" accesskey="p" rel="previous">The TLS record protocol</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-TLS-alert-protocol"></a>
<h3 class="section">3.4 The TLS alert protocol</h3>
<a name="The-Alert-Protocol"></a><a name="index-alert-protocol"></a>

<p>The alert protocol is there to allow signals to be sent between peers.
These signals are mostly used to inform the peer about the cause of a
protocol failure. Some of these signals are used internally by the
protocol and the application protocol does not have to cope with them
(e.g. <code>GNUTLS_A_CLOSE_NOTIFY</code>), and others refer to the
application protocol solely (e.g. <code>GNUTLS_A_USER_CANCELLED</code>).  An
alert signal includes a level indication which may be either fatal or
warning. Fatal alerts always terminate the current connection, and
prevent future re-negotiations using the current session ID. All alert
messages are summarized in the table below.
</p>
<p>The alert messages are protected by the record protocol, thus the
information that is included does not leak. You must take extreme care
for the alert information not to leak to a possible attacker, via
public log files etc. 
</p>
<table>
<tr><td><a name="tab_003aalerts"></a></td></tr>
<thead><tr><th width="55%">Alert</th><th width="10%">ID</th><th width="30%">Description</th></tr></thead>
<tr><td width="55%">GNUTLS_A_CLOSE_NOTIFY</td><td width="10%">0</td><td width="30%">Close notify</td></tr>
<tr><td width="55%">GNUTLS_A_UNEXPECTED_MESSAGE</td><td width="10%">10</td><td width="30%">Unexpected message</td></tr>
<tr><td width="55%">GNUTLS_A_BAD_RECORD_MAC</td><td width="10%">20</td><td width="30%">Bad record MAC</td></tr>
<tr><td width="55%">GNUTLS_A_DECRYPTION_FAILED</td><td width="10%">21</td><td width="30%">Decryption failed</td></tr>
<tr><td width="55%">GNUTLS_A_RECORD_OVERFLOW</td><td width="10%">22</td><td width="30%">Record overflow</td></tr>
<tr><td width="55%">GNUTLS_A_DECOMPRESSION_FAILURE</td><td width="10%">30</td><td width="30%">Decompression failed</td></tr>
<tr><td width="55%">GNUTLS_A_HANDSHAKE_FAILURE</td><td width="10%">40</td><td width="30%">Handshake failed</td></tr>
<tr><td width="55%">GNUTLS_A_SSL3_NO_CERTIFICATE</td><td width="10%">41</td><td width="30%">No certificate (SSL 3.0)</td></tr>
<tr><td width="55%">GNUTLS_A_BAD_CERTIFICATE</td><td width="10%">42</td><td width="30%">Certificate is bad</td></tr>
<tr><td width="55%">GNUTLS_A_UNSUPPORTED_CERTIFICATE</td><td width="10%">43</td><td width="30%">Certificate is not supported</td></tr>
<tr><td width="55%">GNUTLS_A_CERTIFICATE_REVOKED</td><td width="10%">44</td><td width="30%">Certificate was revoked</td></tr>
<tr><td width="55%">GNUTLS_A_CERTIFICATE_EXPIRED</td><td width="10%">45</td><td width="30%">Certificate is expired</td></tr>
<tr><td width="55%">GNUTLS_A_CERTIFICATE_UNKNOWN</td><td width="10%">46</td><td width="30%">Unknown certificate</td></tr>
<tr><td width="55%">GNUTLS_A_ILLEGAL_PARAMETER</td><td width="10%">47</td><td width="30%">Illegal parameter</td></tr>
<tr><td width="55%">GNUTLS_A_UNKNOWN_CA</td><td width="10%">48</td><td width="30%">CA is unknown</td></tr>
<tr><td width="55%">GNUTLS_A_ACCESS_DENIED</td><td width="10%">49</td><td width="30%">Access was denied</td></tr>
<tr><td width="55%">GNUTLS_A_DECODE_ERROR</td><td width="10%">50</td><td width="30%">Decode error</td></tr>
<tr><td width="55%">GNUTLS_A_DECRYPT_ERROR</td><td width="10%">51</td><td width="30%">Decrypt error</td></tr>
<tr><td width="55%">GNUTLS_A_EXPORT_RESTRICTION</td><td width="10%">60</td><td width="30%">Export restriction</td></tr>
<tr><td width="55%">GNUTLS_A_PROTOCOL_VERSION</td><td width="10%">70</td><td width="30%">Error in protocol version</td></tr>
<tr><td width="55%">GNUTLS_A_INSUFFICIENT_SECURITY</td><td width="10%">71</td><td width="30%">Insufficient security</td></tr>
<tr><td width="55%">GNUTLS_A_INTERNAL_ERROR</td><td width="10%">80</td><td width="30%">Internal error</td></tr>
<tr><td width="55%">GNUTLS_A_USER_CANCELED</td><td width="10%">90</td><td width="30%">User canceled</td></tr>
<tr><td width="55%">GNUTLS_A_NO_RENEGOTIATION</td><td width="10%">100</td><td width="30%">No renegotiation is allowed</td></tr>
<tr><td width="55%">GNUTLS_A_UNSUPPORTED_EXTENSION</td><td width="10%">110</td><td width="30%">An unsupported extension was sent</td></tr>
<tr><td width="55%">GNUTLS_A_CERTIFICATE_UNOBTAINABLE</td><td width="10%">111</td><td width="30%">Could not retrieve the specified certificate</td></tr>
<tr><td width="55%">GNUTLS_A_UNRECOGNIZED_NAME</td><td width="10%">112</td><td width="30%">The server name sent was not recognized</td></tr>
<tr><td width="55%">GNUTLS_A_UNKNOWN_PSK_IDENTITY</td><td width="10%">115</td><td width="30%">The SRP/PSK username is missing or not known</td></tr>
<tr><td width="55%">GNUTLS_A_NO_APPLICATION_PROTOCOL</td><td width="10%">120</td><td width="30%">No supported application protocol could be negotiated</td></tr>
</table>

<hr>
<a name="The-TLS-Handshake-Protocol"></a>
<div class="header">
<p>
Next: <a href="#TLS-Extensions" accesskey="n" rel="next">TLS Extensions</a>, Previous: <a href="#The-TLS-Alert-Protocol" accesskey="p" rel="previous">The TLS Alert Protocol</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="The-TLS-handshake-protocol"></a>
<h3 class="section">3.5 The TLS handshake protocol</h3>
<a name="The-Handshake-Protocol"></a><a name="index-handshake-protocol"></a>

<p>The handshake protocol is responsible for the ciphersuite negotiation,
the initial key exchange, and the authentication of the two peers.
This is fully controlled by the application layer, thus your program
has to set up the required parameters. The main handshake function
is <a href="#gnutls_005fhandshake">gnutls_handshake</a>. In the next paragraphs we elaborate on 
the handshake protocol, i.e., the ciphersuite negotiation.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#TLS-Cipher-Suites" accesskey="1">TLS Cipher Suites</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">TLS session parameters.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Authentication" accesskey="2">Authentication</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">TLS authentication.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Client-Authentication" accesskey="3">Client Authentication</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Requesting a certificate from the client.
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Resuming-Sessions" accesskey="4">Resuming Sessions</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Reusing previously established keys.
</td></tr>
</table>


<hr>
<a name="TLS-Cipher-Suites"></a>
<div class="header">
<p>
Next: <a href="#Authentication" accesskey="n" rel="next">Authentication</a>, Up: <a href="#The-TLS-Handshake-Protocol" accesskey="u" rel="up">The TLS Handshake Protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="TLS-ciphersuites"></a>
<h4 class="subsection">3.5.1 TLS ciphersuites</h4>

<p>The handshake protocol of <acronym>TLS</acronym> negotiates cipher suites of
a special form illustrated by the <code>TLS_DHE_RSA_WITH_3DES_CBC_SHA</code> cipher suite name.  A typical cipher
suite contains these parameters:
</p>
<ul>
<li> The key exchange algorithm.
<code>DHE_RSA</code> in the example.

</li><li> The Symmetric encryption algorithm and mode
<code>3DES_CBC</code> in this example.

</li><li> The MAC<a name="DOCF3" href="#FOOT3"><sup>3</sup></a> algorithm used for authentication.
<code>MAC_SHA</code> is used in the above example.

</li></ul>

<p>The cipher suite negotiated in the handshake protocol will affect the
record protocol, by enabling encryption and data authentication.  Note
that you should not over rely on <acronym>TLS</acronym> to negotiate the
strongest available cipher suite. Do not enable ciphers and algorithms
that you consider weak.
</p>
<p>All the supported ciphersuites are listed in <a href="#ciphersuites">ciphersuites</a>.
</p>
<hr>
<a name="Authentication"></a>
<div class="header">
<p>
Next: <a href="#Client-Authentication" accesskey="n" rel="next">Client Authentication</a>, Previous: <a href="#TLS-Cipher-Suites" accesskey="p" rel="previous">TLS Cipher Suites</a>, Up: <a href="#The-TLS-Handshake-Protocol" accesskey="u" rel="up">The TLS Handshake Protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Authentication-1"></a>
<h4 class="subsection">3.5.2 Authentication</h4>

<p>The key exchange algorithms of the <acronym>TLS</acronym> protocol offer
authentication, which is a prerequisite for a secure connection. 
The available authentication methods in <acronym>GnuTLS</acronym> follow.
</p>
<ul>
<li> Certificate authentication: Authenticated key exchange using public key infrastructure and certificates (X.509 or OpenPGP).
</li><li> <acronym>SRP</acronym> authentication: Authenticated key exchange using a password.
</li><li> <acronym>PSK</acronym> authentication: Authenticated key exchange using a pre-shared key.
</li><li> Anonymous authentication: Key exchange without peer authentication.

</li></ul>

<hr>
<a name="Client-Authentication"></a>
<div class="header">
<p>
Next: <a href="#Resuming-Sessions" accesskey="n" rel="next">Resuming Sessions</a>, Previous: <a href="#Authentication" accesskey="p" rel="previous">Authentication</a>, Up: <a href="#The-TLS-Handshake-Protocol" accesskey="u" rel="up">The TLS Handshake Protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Client-authentication"></a>
<h4 class="subsection">3.5.3 Client authentication</h4>
<a name="index-client-certificate-authentication"></a>

<p>In the case of ciphersuites that use certificate authentication, the
authentication of the client is optional in <acronym>TLS</acronym>.  A server
may request a certificate from the client using the
<a href="#gnutls_005fcertificate_005fserver_005fset_005frequest">gnutls_certificate_server_set_request</a> function. We elaborate 
in <a href="#Certificate-credentials">Certificate credentials</a>.
</p>
<hr>
<a name="Resuming-Sessions"></a>
<div class="header">
<p>
Previous: <a href="#Client-Authentication" accesskey="p" rel="previous">Client Authentication</a>, Up: <a href="#The-TLS-Handshake-Protocol" accesskey="u" rel="up">The TLS Handshake Protocol</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Resuming-sessions"></a>
<h4 class="subsection">3.5.4 Resuming sessions</h4>
<a name="resume"></a><a name="index-resuming-sessions"></a>
<a name="index-session-resumption"></a>

<p>The TLS handshake process performs expensive calculations
and a busy server might easily be put under load. To 
reduce the load, session resumption may be used. This
is a feature of the <acronym>TLS</acronym> protocol which allows a
client to connect to a server after a successful handshake, without
the expensive calculations.  This is achieved by re-using the previously
established keys, meaning the server needs to store the state of established
connections (unless session tickets are used &ndash; <a href="#Session-tickets">Session tickets</a>).
</p>
<p>Session resumption is an integral part of <acronym>GnuTLS</acronym>, and 
<a href="#Session-resumption">Session resumption</a>, <a href="#ex_003aresume_002dclient">ex:resume-client</a> illustrate typical 
uses of it.
</p>
<hr>
<a name="TLS-Extensions"></a>
<div class="header">
<p>
Next: <a href="#How-to-use-TLS-in-application-protocols" accesskey="n" rel="next">How to use TLS in application protocols</a>, Previous: <a href="#The-TLS-Handshake-Protocol" accesskey="p" rel="previous">The TLS Handshake Protocol</a>, Up: <a href="#Introduction-to-TLS" accesskey="u" rel="up">Introduction to TLS</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="TLS-extensions"></a>
<h3 class="section">3.6 TLS extensions</h3>
<a name="index-TLS-extensions"></a>

<p>A number of extensions to the <acronym>TLS</acronym> protocol have been
proposed mainly in [<em>TLSEXT</em>]. The extensions supported
in <acronym>GnuTLS</acronym> are:
</p>
<ul>
<li> Maximum fragment length negotiation
</li><li> Server name indication
</li><li> Session tickets
</li><li> HeartBeat
</li><li> Safe Renegotiation
</li></ul>

<p>and they will be discussed in the subsections that follow.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Maximum-fragment-length-negotiation" accesskey="1">Maximum fragment length negotiation</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Server-name-indication" accesskey="2">Server name indication</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Session-tickets" accesskey="3">Session tickets</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#HeartBeat" accesskey="4">HeartBeat</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Safe-renegotiation" accesskey="5">Safe renegotiation</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#OCSP-status-request" accesskey="6">OCSP status request</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#SRTP" accesskey="7">SRTP</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Application-Layer-Protocol-Negotiation-_0028ALPN_0029" accesskey="8">Application Layer Protocol Negotiation (ALPN)</a>:</td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr>
<a name="Maximum-fragment-length-negotiation"></a>
<div class="header">
<p>
Next: <a href="#Server-name-indication" accesskey="n" rel="next">Server name indication</a>, Up: <a href="#TLS-Extensions" accesskey="u" rel="up">TLS Extensions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Maximum-fragment-length-negotiation-1"></a>
<h4 class="subsection">3.6.1 Maximum fragment length negotiation</h4>
<a name="index-TLS-extensions-1"></a>
<a name="index-maximum-fragment-length"></a>

<p>This extension allows a <acronym>TLS</acronym> implementation to negotiate a
smaller value for record packet maximum length. This extension may be
useful to clients with constrained capabilities. The functions shown
below can be used to control this extension.
</p>
<dl compact="compact">
<dt><code><var>size_t</var> <a href="#gnutls_005frecord_005fget_005fmax_005fsize">gnutls_record_get_max_size</a> (gnutls_session_t <var>session</var>)</code></dt>
<dt><code><var>ssize_t</var> <a href="#gnutls_005frecord_005fset_005fmax_005fsize">gnutls_record_set_max_size</a> (gnutls_session_t <var>session</var>, size_t <var>size</var>)</code></dt>
</dl>

<hr>
<a name="Server-name-indication"></a>
<div class="header">
<p>
Next: <a href="#Session-tickets" accesskey="n" rel="next">Session tickets</a>, Previous: <a href="#Maximum-fragment-length-negotiation" accesskey="p" rel="previous">Maximum fragment length negotiation</a>, Up: <a href="#TLS-Extensions" accesskey="u" rel="up">TLS Extensions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Server-name-indication-1"></a>
<h4 class="subsection">3.6.2 Server name indication</h4>
<a name="serverind"></a><a name="index-TLS-extensions-2"></a>
<a name="index-server-name-indication"></a>

<p>A common problem in <acronym>HTTPS</acronym> servers is the fact that the
<acronym>TLS</acronym> protocol is not aware of the hostname that a client
connects to, when the handshake procedure begins. For that reason the
<acronym>TLS</acronym> server has no way to know which certificate to send.
</p>
<p>This extension solves that problem within the <acronym>TLS</acronym> protocol,
and allows a client to send the HTTP hostname before the handshake
begins within the first handshake packet.  The functions
<a href="#gnutls_005fserver_005fname_005fset">gnutls_server_name_set</a> and <a href="#gnutls_005fserver_005fname_005fget">gnutls_server_name_get</a> can be
used to enable this extension, or to retrieve the name sent by a
client.
</p>
<dl compact="compact">
<dt><code><var>int</var> <a href="#gnutls_005fserver_005fname_005fset">gnutls_server_name_set</a> (gnutls_session_t <var>session</var>, gnutls_server_name_type_t <var>type</var>, const void * <var>name</var>, size_t <var>name_length</var>)</code></dt>
<dt><code><var>int</var> <a href="#gnutls_005fserver_005fname_005fget">gnutls_server_name_get</a> (gnutls_session_t <var>session</var>, void * <var>data</var>, size_t * <var>data_length</var>, unsigned int * <var>type</var>, unsigned int <var>indx</var>)</code></dt>
</dl>

<hr>
<a name="Session-tickets"></a>
<div class="header">
<p>
Next: <a href="#HeartBeat" accesskey="n" rel="next">HeartBeat</a>, Previous: <a href="#Server-name-indication" accesskey="p" rel="previous">Server name indication</a>, Up: <a href="#TLS-Extensions" accesskey="u" rel="up">TLS Extensions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Session-tickets-1"></a>
<h4 class="subsection">3.6.3 Session tickets</h4>
<a name="index-TLS-extensions-3"></a>
<a name="index-session-tickets"></a>
<a name="index-tickets"></a>

<p>To resume a TLS session the server normally store session parameters.  This
complicates deployment, and could be avoiding by delegating the storage
to the client. Because session parameters are sensitive they are encrypted
and authenticated with a key only known to the server and then sent to the
client. The Session Tickets extension is described in RFC 5077 [<em>TLSTKT</em>].
</p>
<p>Since version 3.1.3 GnuTLS clients transparently support session tickets.
</p>
<hr>
<a name="HeartBeat"></a>
<div class="header">
<p>
Next: <a href="#Safe-renegotiation" accesskey="n" rel="next">Safe renegotiation</a>, Previous: <a href="#Session-tickets" accesskey="p" rel="previous">Session tickets</a>, Up: <a href="#TLS-Extensions" accesskey="u" rel="up">TLS Extensions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="HeartBeat-1"></a>
<h4 class="subsection">3.6.4 HeartBeat</h4>
<a name="index-TLS-extensions-4"></a>
<a name="index-heartbeat"></a>

<p>This TLS extension allows to ping and receive confirmation from the peer,
is described in [<em>RFC6520</em>]. The extension is disabled by default and
<a href="#gnutls_005fheartbeat_005fenable">gnutls_heartbeat_enable</a> can be used to enable it. A policy
may be negotiated to only allow sending heartbeat messages or sending and receiving.
The current session policy can be checked with <a href="#gnutls_005fheartbeat_005fallowed">gnutls_heartbeat_allowed</a>. 
The requests coming from the peer result to <code>GNUTLS_E_HERTBEAT_PING_RECEIVED</code>
being returned from the receive function. Ping requests to peer can be send via
<a href="#gnutls_005fheartbeat_005fping">gnutls_heartbeat_ping</a>. 
</p>
<dl compact="compact">
<dt><code><var>int</var> <a href="#gnutls_005fheartbeat_005fallowed">gnutls_heartbeat_allowed</a> (gnutls_session_t <var>session</var>, unsigned int <var>type</var>)</code></dt>
<dt><code><var>void</var> <a href="#gnutls_005fheartbeat_005fenable">gnutls_heartbeat_enable</a> (gnutls_session_t <var>session</var>, unsigned int <var>type</var>)</code></dt>
</dl>

<dl compact="compact">
<dt><code><var>int</var> <a href="#gnutls_005fheartbeat_005fping">gnutls_heartbeat_ping</a> (gnutls_session_t <var>session</var>, size_t <var>data_size</var>, unsigned int <var>max_tries</var>, unsigned int <var>flags</var>)</code></dt>
<dt><code><var>int</var> <a href="#gnutls_005fheartbeat_005fpong">gnutls_heartbeat_pong</a> (gnutls_session_t <var>session</var>, unsigned int <var>flags</var>)</code></dt>
<dt><code><var>void</var> <a href="#gnutls_005fheartbeat_005fset_005ftimeouts">gnutls_heartbeat_set_timeouts</a> (gnutls_session_t <var>session</var>, unsigned int <var>retrans_timeout</var>, unsigned int <var>total_timeout</var>)</code></dt>
<dt><code><var>unsigned int</var> <a href="#gnutls_005fheartbeat_005fget_005ftimeout">gnutls_heartbeat_get_timeout</a> (gnutls_session_t <var>session</var>)</code></dt>
</dl>

<hr>
<a name="Safe-renegotiation"></a>
<div class="header">
<p>
Next: <a href="#OCSP-status-request" accesskey="n" rel="next">OCSP status request</a>, Previous: <a href="#HeartBeat" accesskey="p" rel="previous">HeartBeat</a>, Up: <a href="#TLS-Extensions" accesskey="u" rel="up">TLS Extensions</a> &nbsp; [<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="#Function-and-Data-Index" title="Index" rel="index">Index</a>]</p>
</div>
<a name="Safe-renegotiation-1"></a>
<h4 class="subsection">3.6.5 Safe renegotiation</h4>
<a name="index-renegotiation"></a>
<a name="index-safe-renegotiation"></a>

<p>TLS gives the option to two communicating parties to renegotiate
and update their security parameters. One useful example of this feature
was for a client to initially connect using anonymous negotiation to a
server, and the renegotiate using some authenticated ciphersuite. This occurred
to avoid having the client sending its credentials in the clear.
</p>
<p>However this renegotiation, as initially designed would not ensure that
the party one is renegotiating is the same as the one in the initial negotiation.
For example one server could forward all renegotiation traffic to an other
server who will see this traffic as an initial negotiation attempt.
</p>
<p>This might be seen as a valid design decision, but it seems it was
not widely known or understood, thus today some application protocols the TLS
renegotiation feature in a manner that enables a malicious server to insert
content of his choice in the beginning of a TLS session.
</p>
<p>The most prominent vulnerability was with HTTPS. There servers request
a renegotiation to enforce an anonymous user to use a certificate in order
to access certain parts of a web site.  The
attack works by having the attacker simulate a client and connect to a
server, with server-only authentication, and send some data intended
to cause harm.  The server will then require renegotiation from him
in order to perform the request. 
When the proper client attempts to contact the server,
the attacker hijacks that connection and forwards traffic to
the initial server that requested renegotiation.  The
attacker will not be able to read the data exchanged between the
client and the server.  However, the server will (incorrectly) assume
that the initial request sent by the attacker was sent by the now authenticated
client.  The result is a prefix plain-text injection attack.
</p>
<p>The above is just one example.  Other vulnerabilities exists that do
not rely on the TLS renegotiation to change the client&rsquo;s authenticated
status (either TLS or application layer).
</p>
<p>While fixing these application protocols and implementations would be
one natural reaction, an extension to TLS has been designed that
cryptographically binds together any renegotiated handshakes with the
initial negotiation.  When the extension is used, the attack is
detected and the session can be terminated.  The extension is
specified in [<em>RFC5746</em>].
</p>
<p>GnuTLS supports the safe renegotiation extension.  The default
behavior is as follows.  Clients will attempt to negotiate the safe
renegotiation extension when talking to servers.  Servers will accept
the extension when presented by clients.  Clients and servers will
permit an initial handshake to complete even when the other side does
not support the safe renegotiation extension.  Clients and servers
will refuse renegotiation attempts when the extension has not been
negotiated.
</p>
<p>Note that permitting clients to connect to servers when the safe
renegotiation extension is not enabled, is open up for attacks.
Changing this default behavior would prevent interoperability against
the majority of deployed servers out there.  We will reconsider this
default behavior in the future when more servers have been upgraded.
Note that it is easy to configure clients to always require the safe
renegotiation extension from servers.
</p>
<p>To modify the default behavior, we have introduced some new priority
strings (see <a href="#Priority-Strings">Priority Strings</a>).  
The <code>%UNSAFE_RENEGOTIATION</code> priority string permits
(re-)handshakes even when the safe renegotiation extension was not
negotiated. The default behavior is <code>%PARTIAL_RENEGOTIATION</code> that will
prevent renegotiation with clients and servers not supporting the
extension. This is secure for servers but leaves clients vulnerable
to some attacks, but this is a trade-off between security and compatibility
with old servers. The <code>%SAFE_RENEGOTIATION</code> priority string makes
clients and servers require the extension for every handshake. The latter
is the most secure option for clients, at the cost of not being able
to connect to legacy servers. Servers will 